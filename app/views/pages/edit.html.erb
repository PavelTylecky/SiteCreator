<script src="http://www.appelsiini.net/download/jquery.jeditable.mini.js"></script>


<style type="text/css">
.column{
	width:49%;
	margin-right:.5%;
	min-height:300px;
	background:#fff;
	float:left;
}
 .dragbox{
	margin:5px 2px  20px;
	background:#fff;
	position:relative;
	border:1px solid #ddd;
	-moz-border-radius:5px;
	-webkit-border-radius:5px;
}
 .dragbox h2{
	margin:0;
	font-size:12px;
	padding:5px;
	background:#f0f0f0;
	color:#000;
	border-bottom:1px solid #eee;
	font-family:Verdana;
	cursor:move;
}
.dragbox-content{
	background:#fff;
	min-height:100px; margin:5px;
	font-family:'Lucida Grande', Verdana; font-size:0.8em; line-height:1.5em;
}
.column  .placeholder{
	background: #f0f0f0;
	border:1px dashed #ddd;
}
.dragbox h2.collapse{
	background:#f0f0f0;
}
.dragbox h2 .configure{
	font-size:11px; font-weight:normal;
	margin-right:30px; float:right;
}
</style>
<style>

  #droppable { margin:5px 2px  20px;
	background:#fff;
	border:1px solid #ddd;  }
  </style>
<style type="text/css">
.items{float:left;}
.items div{width:50px;background:#444;color:#fff;margin-bottom:4px;padding:6px;text-align:center}

.content{width:500px;min-height:500px;background:#eee;position:absolute;left:70px;padding:10px}

.items .block,
.content .block{height:100px!important;background:#bbb;margin-bottom:10px;width:500px;color:#000}

/* style the sortable placeholder */
.content .block-placeholder{height:98px!important;border:1px dotted black;margin-bottom:10px;width:498px;}
</style>

<div class="row">
  <div class="col-xs-6 col-md-4">
  	<div class="btn-toolbar">
	  <div class="btn-group-vertical">
	      <a href="#" class="btn btn-inverse">Text</a>
	      <a href="#" class="btn btn-inverse">Image</a>
	      <a href="#" class="btn btn-inverse">Table</a>
	      <i class="fa fa-picture-o fa-2x" aria-hidden="true"></i>
	  </div>
	  <div class="btn-group">
	      <a href="#" class="btn btn-inverse"><i class="icon-white icon-trash"></i></a>
	  </div>
	</div>
  </div>
  <div class="col-xs-12 col-md-8">
  	<%= render "page" %>
  </div>
  
</div>
<div class="dragbox draggable" data-type="markdown_text">
	<div class="edit_area" data-content="**!!!!**">
  Drag me to my target
</div>
</div>
 


<!--<iframe src="https://www.youtube.com/embed/yqYq6If4YbY" frameborder="0" allowfullscreen></iframe>-->
<script type="text/javascript" >
	$(document).ready(function() {

		pageLoad();

		//var w = $('.column .dragbox').width()
		//$('.draggable').width(w);

function pageLoad() {
	console.log("PageLoad")
    $('.edit_area').editable(function(value, settings) {
    	console.log(this);
    	console.log(value);
    	return(value);
  	}, {
  		// data:  function(value, settings) {
    //   	return $(this).data('content');
   	// 	},
  		indicator : 'Saving...',
    	tooltip   : 'Click to edit...',
  	}); 

  }
		$('.draggable').draggable({
    helper: "clone",
    connectToSortable: ".column"
});
		$('.column').sortable({  
	    connectWith: '.column',    
	    cursor: 'move',  
	    placeholder: 'placeholder',  
	    forcePlaceholderSize: true,  
	    opacity: 0.4, 
	    update: function(event, ui){  
	    	// console.log("!!!!")
	    	 ui.item.attr('style','');
	    	 pageLoad();
	    	// console.log(ui.item)
	    	//ui.item.addClass("dragbox")
	    },
	    stop: function(event, ui){  
           console.log("stop")
           updateWidgetData();
        },

		})  
		.disableSelection(); 

		function updateWidgetData(){  
		  var items=[];  
	    $('.column').each(function(){  
	      var columnId=$(this).attr('id');  
	      $('.dragbox', this).each(function(i){
	       	console.log($(this).data('id'));   
	        var item={  
	          id: $(this).data('id'),   
	          order : i,  
	          type: $(this).data('type'),
	          div_id: columnId  
	        }; 
	        console.log("item", $(this).text())
	        if (item["type"] == "markdown_text") {
	        	item["markdown"] = $(this).text();
	        } 
	        items.push(item);  
	      });  
	    });  
	    var sortorder={ items: items };  
	    console.log(sortorder);  
	 	 $.ajax({
	      type: "PATCH",
	      url: window.location.pathname.replace("edit",""),
	      data: {page_elements: JSON.stringify( sortorder )},
	      dataType: 'json',
	      success: function(msg) {
	      	console.log("success")
	      }
	           
	    });
		}
	});
</script>



