<script src="http://www.appelsiini.net/download/jquery.jeditable.mini.js"></script>


<style type="text/css">
.column{
	width:49%;
	margin-right:.5%;
	min-height:300px;
	background:#fff;
	float:left;
}
 .dragbox{
	margin:5px 2px  20px;
	background:#fff;
	position:relative;
	border:1px solid #ddd;
	-moz-border-radius:5px;
	-webkit-border-radius:5px;
}
.column  .placeholder{
	background: #f0f0f0;
	border:1px dashed #ddd;
}

div iframe{
		display:block; 
		margin:10px 1% 10px 1%;
		width:98%;
}
.panel {
	margin:10px 10px 10px 10px;
	border-bottom:1px solid #eee;
}
</style>

<div class="row">
	<div class="panel panel-default">
  <div class="panel-body">
    Basic panel example
  </div>
</div>
</div>
<div class="row">
  <div class="col-xs-6 col-md-4">
  	<div class="btn-toolbar">
	  <div class="btn-group-vertical">
	       <button class="btn"><i class="fa fa-picture-o fa-2x" aria-hidden="true"></i></button>
	      <button class="btn"><i class="fa fa-youtube-play fa-2x" aria-hidden="true"></i></button>
	      <button class="btn"><i class="fa fa-font fa-2x" aria-hidden="true"></i></button>
	  </div>
	</div>
  </div>
  <div class="col-xs-12 col-md-8">
  	<%= render "page" %>
  </div>
  
</div>
<div class="dragbox draggable" data-type="markdown_text">
	<div class="edit_area" data-content="**!!!!**">
  Drag me to my target
</div>
</div>
 


<!--<iframe src="https://www.youtube.com/embed/yqYq6If4YbY" frameborder="0" allowfullscreen></iframe>-->
<script type="text/javascript" >
	$(document).ready(function() {

		pageLoad();

		//var w = $('.column .dragbox').width()
		//$('.draggable').width(w);

function pageLoad() {
	console.log("PageLoad")
    $('.edit_area').editable(function(value, settings) {
    	console.log(this);
    	console.log(value);
    	
    	return(value);
  	}, {
  		// data:  function(value, settings) {
    //   	return $(this).data('content');
   	// 	},
  		indicator : 'Saving...',
    	tooltip   : 'Click to edit...',
    	callback : function(value, settings) {
    		console.log("callback");
    		updateWidgetData();

     }
  	}); 

  }
		$('.draggable').draggable({
    helper: "clone",
    connectToSortable: ".column"
});
		$('.column').sortable({  
	    connectWith: '.column',    
	    cursor: 'move',  
	    placeholder: 'placeholder',  
	    forcePlaceholderSize: true,  
	    opacity: 0.4, 
	    update: function(event, ui){  
	    	 ui.item.attr('style','');
	    	 pageLoad();

	    },
	    stop: function(event, ui){  
           console.log("stop")
           updateWidgetData();
        },

		})  
		.disableSelection(); 

		function updateWidgetData(){  
		  var items=[];  
	    $('.column').each(function(){  
	      var columnId=$(this).attr('id');  
	      $('.dragbox', this).each(function(i){
	       	console.log($(this).data('id'));   
	        var item={  
	          id: $(this).data('id'),   
	          order : i,  
	          type: $(this).data('type'),
	          div_id: columnId  
	        }; 
	        if (item["type"] == "markdown_text") {
	        	item["markdown"] = $(this).text();
	        } 
	        items.push(item);  
	      });  
	    });  
	    var sortorder={ items: items };  
	    console.log(sortorder);  
	 	 $.ajax({
	      type: "PATCH",
	      url: window.location.pathname.replace("edit",""),
	      data: {page_elements: JSON.stringify( sortorder )},
	      dataType: 'json',
	      success: function(msg) {
	      	console.log("success")
	      }
	           
	    });
		}
	});
</script>



