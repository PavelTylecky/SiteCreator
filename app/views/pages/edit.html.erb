
<script src="//widget.cloudinary.com/global/all.js" type="text/javascript"></script>         

<!-- <img src="" class="dynamic_image"
     data-src="roses_ba5tmk" 
     data-width="115" data-height="135"
     data-crop="thumb" data-gravity="faces" data-radius="20"/> -->

<style type="text/css">
.popover-content {
  height: 200px;
  overflow-y: auto;
 }

</style>
<div class="container">


	<div class="row">
  	<div class="col-xs-6 col-md-4">
  		<div class="btn-toolbar">
	  		<div class="btn-group">
	       	<button class="btn draggable" id="picture-btn" data-original-title="Creativity Tuts" 
   data-placement="bottom" rel="popover"><i class="fa fa-picture-o fa-2x" aria-hidden="true"></i>
	       		<!-- <div>
				      <%= render "pictures" %>				    
				    </div> -->

	       	</button>
	      	<button class="btn draggable" id="video-btn"><i class="fa fa-youtube-play fa-2x" aria-hidden="true"></i></button>
	      	<button class="btn draggable" id="text-btn"><i class="fa fa-font fa-2x" aria-hidden="true"></i></button>
	      	<button class="btn" id="save"> Save </button>

	  		</div>
	  		 <div class="dialog" style="display:none"  id="pictures" >
					  <%= render "pictures" %>
					  
					</div>
	  		
			</div>
  	</div>
  	<div class="col-xs-12 col-md-8">
  		<%= render "page" %>
  	</div>

	</div>


<script type="text/javascript" >
  
  function updateWidgetData(){  
	  var items=[];  
	  $("div[class*='column']").each(function(){  
	    var columnId=$(this).attr('id'); 
	    $('.dragbox', this).each(function(i){
  
	      var item={  
	        id: $(this).data('id'),   
	        order : i,  
	        type: $(this).data('type'),
	        div_id: columnId  
	      }; 
	      if (item["type"] == "markdown_text") {
	       	item["markdown"] = $(this).text();
	      } else if (item["type"] == "video") {
	       	//var text = $(this).text();
	       	item["url"] = $(this).text() || $(this).find('iframe').attr("src") //"https://www.youtube.com/embed/0nCOZyoeA14"//$(this).text();
	      } else if (item["type"] == "picture") {
	      	item["public_id"] = $(this).find('img').data("public");
	      }
	      items.push(item);  
	    });  
	  });  
	  var sortorder={ items: items };  
	  console.log(sortorder);  
	 	 $.ajax({
	      type: "PATCH",
	      url: window.location.pathname.replace("edit",""),
	      data: {page_elements: JSON.stringify( sortorder )},
	      dataType: 'script',
	      success: function(msg) {
	      	console.log("success")
	      }
	           
	    });
	}
	$(function () {
		$('#picture-btn')
   .popover({trigger: "click", html:true, content: function () {
        return $('<div>').html('<%= escape_javascript(render "pictures") %>');

      }})
   .click(function(e) { 
       e.preventDefault(); 
       initializeSortable();
       $(this).focus(); 
   });
    //$('#example').popover({trigger: "click", html:true});
});
	$(document).ready(function() {
		//$.cloudinary.config({ cloud_name: 'dg1a2dx9d', api_key: '643398365774925'})

		//$(".dragbox > img").cloudinary();

		pageLoad();
		initializeSortable();
		// setClickableTooltip(
  //       '#picture',
  //       'diff content with <a href="http://abbysdoor.com">link</a> :)'
  //   );
	
	});





$("#save").click(function() {
	updateWidgetData();
});


$(".dragbox").hover( 
	function() {
        $(this).find('.close').delay(50).fadeIn(10);
    },
    function() {
        $(this).find('.close').delay(50).fadeOut(10);
    });
// $('button.close').click(function (e) {
// 	$(this).parent().remove();
// });
$('#picture').mouseenter(function(){
  var pos = $(this).position();
  $(this).find('div').css('top', (pos.top)+50 + 'px').fadeIn();
}).mouseleave(function(){
  $(this).find('div').fadeOut();
});


</script>


